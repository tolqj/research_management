# å¼€å‘æŒ‡å—

> é¢å‘å¼€å‘è€…çš„å®Œæ•´å¼€å‘æ–‡æ¡£ï¼ŒåŒ…å«ä»£ç è§„èŒƒã€APIå¼€å‘ã€å‰ç«¯å¼€å‘ç­‰å†…å®¹

## ğŸ“‹ ç›®å½•

- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [é¡¹ç›®ç»“æ„è¯´æ˜](#é¡¹ç›®ç»“æ„è¯´æ˜)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [åç«¯å¼€å‘](#åç«¯å¼€å‘)
- [å‰ç«¯å¼€å‘](#å‰ç«¯å¼€å‘)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)
- [æµ‹è¯•æŒ‡å—](#æµ‹è¯•æŒ‡å—)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å¼€å‘ç¯å¢ƒæ­å»º

### 1. IDEæ¨è

**åç«¯ï¼ˆPythonï¼‰**:
- PyCharm Professionalï¼ˆæ¨èï¼‰
- Visual Studio Code + Pythonæ’ä»¶

**å‰ç«¯ï¼ˆVueï¼‰**:
- WebStormï¼ˆæ¨èï¼‰
- Visual Studio Code + Volaræ’ä»¶

### 2. VS Codeæ’ä»¶æ¨è

```json
{
  "recommendations": [
    "ms-python.python",
    "ms-python.vscode-pylance",
    "Vue.volar",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "formulahendry.auto-rename-tag",
    "eamodio.gitlens"
  ]
}
```

### 3. Pythonè™šæ‹Ÿç¯å¢ƒé…ç½®

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd backend
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¼€å‘æ¨¡å¼ä¾èµ–
pip install pytest pytest-cov black flake8
```

### 4. Node.jsç¯å¢ƒé…ç½®

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å®‰è£…å¼€å‘å·¥å…·
npm install -g @vue/cli
npm install -g eslint prettier
```

---

## é¡¹ç›®ç»“æ„è¯´æ˜

### åç«¯ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ crud/                      # æ•°æ®åº“CRUDæ“ä½œå±‚
â”‚   â”œâ”€â”€ achievement.py         # æˆæœCRUD
â”‚   â”œâ”€â”€ fund.py               # ç»è´¹CRUD
â”‚   â”œâ”€â”€ paper.py              # è®ºæ–‡CRUD
â”‚   â”œâ”€â”€ project.py            # é¡¹ç›®CRUD
â”‚   â””â”€â”€ user.py               # ç”¨æˆ·CRUD
â”œâ”€â”€ routers/                   # APIè·¯ç”±å±‚
â”‚   â”œâ”€â”€ achievement.py         # æˆæœAPI
â”‚   â”œâ”€â”€ auth.py               # è®¤è¯API
â”‚   â”œâ”€â”€ fund.py               # ç»è´¹API
â”‚   â”œâ”€â”€ paper.py              # è®ºæ–‡API
â”‚   â”œâ”€â”€ project.py            # é¡¹ç›®API
â”‚   â”œâ”€â”€ statistics.py         # ç»Ÿè®¡API
â”‚   â””â”€â”€ user.py               # ç”¨æˆ·API
â”œâ”€â”€ utils/                     # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ audit.py              # å®¡è®¡æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ password_policy.py    # å¯†ç ç­–ç•¥
â”‚   â”œâ”€â”€ security.py           # å®‰å…¨å·¥å…·ï¼ˆJWTã€å¯†ç åŠ å¯†ï¼‰
â”‚   â””â”€â”€ timer.py              # è®¡æ—¶å™¨
â”œâ”€â”€ database.py               # æ•°æ®åº“é…ç½®
â”œâ”€â”€ main.py                   # åº”ç”¨å…¥å£
â”œâ”€â”€ models.py                 # SQLAlchemyæ¨¡å‹
â”œâ”€â”€ schemas.py                # Pydantic schemas
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–
â””â”€â”€ setup_database.py         # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

### å‰ç«¯ç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/               # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ services/             # APIæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ achievement.js    # æˆæœAPI
â”‚   â”‚   â”œâ”€â”€ auth.js          # è®¤è¯API
â”‚   â”‚   â”œâ”€â”€ fund.js          # ç»è´¹API
â”‚   â”‚   â”œâ”€â”€ paper.js         # è®ºæ–‡API
â”‚   â”‚   â”œâ”€â”€ project.js       # é¡¹ç›®API
â”‚   â”‚   â”œâ”€â”€ request.js       # Axiosé…ç½®
â”‚   â”‚   â”œâ”€â”€ statistics.js    # ç»Ÿè®¡API
â”‚   â”‚   â””â”€â”€ user.js          # ç”¨æˆ·API
â”‚   â”œâ”€â”€ store/                # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ user.js          # ç”¨æˆ·çŠ¶æ€
â”‚   â”œâ”€â”€ views/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ achievement/      # æˆæœç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ dashboard/        # å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ fund/            # ç»è´¹ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ paper/           # è®ºæ–‡ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ project/         # é¡¹ç›®ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ system/          # ç³»ç»Ÿç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ user.vue     # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ profile.vue  # ä¸ªäººä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ layout.vue       # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ login.vue        # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ App.vue              # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.js              # å…¥å£æ–‡ä»¶
â”œâ”€â”€ index.html               # HTMLæ¨¡æ¿
â”œâ”€â”€ package.json             # ä¾èµ–é…ç½®
â””â”€â”€ vite.config.js           # Viteé…ç½®
```

---

## ä»£ç è§„èŒƒ

### Pythonä»£ç è§„èŒƒ

#### 1. å‘½åè§„èŒƒ

```python
# æ¨¡å—åï¼šå°å†™+ä¸‹åˆ’çº¿
# æ–‡ä»¶åï¼šuser_service.py

# ç±»åï¼šå¤§é©¼å³°
class UserService:
    pass

# å‡½æ•°åï¼šå°å†™+ä¸‹åˆ’çº¿
def get_user_by_id(user_id: int):
    pass

# å˜é‡åï¼šå°å†™+ä¸‹åˆ’çº¿
user_count = 10
is_active = True

# å¸¸é‡ï¼šå¤§å†™+ä¸‹åˆ’çº¿
MAX_LOGIN_ATTEMPTS = 5
DEFAULT_PAGE_SIZE = 20

# ç§æœ‰æˆå‘˜ï¼šå‰ç¼€ä¸‹åˆ’çº¿
_internal_cache = {}
```

#### 2. ç±»å‹æ³¨è§£

```python
from typing import List, Optional, Dict, Any

def get_users(
    skip: int = 0,
    limit: int = 100,
    role: Optional[str] = None
) -> List[Dict[str, Any]]:
    """
    è·å–ç”¨æˆ·åˆ—è¡¨
    
    Args:
        skip: è·³è¿‡è®°å½•æ•°
        limit: è¿”å›è®°å½•æ•°
        role: è§’è‰²ç­›é€‰
        
    Returns:
        ç”¨æˆ·åˆ—è¡¨
    """
    pass
```

#### 3. æ–‡æ¡£å­—ç¬¦ä¸²

```python
def create_user(db: Session, user: schemas.UserCreate) -> models.User:
    """
    åˆ›å»ºæ–°ç”¨æˆ·
    
    Args:
        db: æ•°æ®åº“ä¼šè¯
        user: ç”¨æˆ·åˆ›å»ºschema
        
    Returns:
        åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
        
    Raises:
        HTTPException: ç”¨æˆ·åå·²å­˜åœ¨
    """
    pass
```

#### 4. å¯¼å…¥é¡ºåº

```python
# 1. æ ‡å‡†åº“
import os
import sys
from datetime import datetime

# 2. ç¬¬ä¸‰æ–¹åº“
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

# 3. æœ¬åœ°æ¨¡å—
from database import get_db
from models import User
from schemas import UserCreate
```

### JavaScript/Vueä»£ç è§„èŒƒ

#### 1. å‘½åè§„èŒƒ

```javascript
// å˜é‡åï¼šå°é©¼å³°
let userName = 'admin'
const maxRetryCount = 3

// å¸¸é‡ï¼šå¤§å†™+ä¸‹åˆ’çº¿
const API_BASE_URL = '/api'
const DEFAULT_TIMEOUT = 5000

// ç»„ä»¶åï¼šå¤§é©¼å³°
export default {
  name: 'UserManagement'
}

// æ–¹æ³•åï¼šå°é©¼å³°
const getUserList = async () => {
  // ...
}
```

#### 2. Vue 3 Composition APIè§„èŒƒ

```vue
<script setup>
import { ref, reactive, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'

// 1. å¯¼å…¥
import { getUserList } from '@/services/user'

// 2. è·¯ç”±/Store
const router = useRouter()

// 3. å“åº”å¼æ•°æ®
const tableData = ref([])
const form = reactive({
  username: '',
  password: ''
})

// 4. è®¡ç®—å±æ€§
const totalUsers = computed(() => tableData.value.length)

// 5. æ–¹æ³•
const loadData = async () => {
  const res = await getUserList()
  tableData.value = res
}

// 6. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadData()
})
</script>
```

#### 3. ç»„ä»¶ç»“æ„

```vue
<template>
  <div class="container">
    <!-- æœç´¢åŒºåŸŸ -->
    <el-form :inline="true">
      <!-- ... -->
    </el-form>
    
    <!-- è¡¨æ ¼åŒºåŸŸ -->
    <el-table :data="tableData">
      <!-- ... -->
    </el-table>
    
    <!-- åˆ†é¡µåŒºåŸŸ -->
    <el-pagination />
  </div>
</template>

<script setup>
// è„šæœ¬å†…å®¹
</script>

<style scoped>
/* æ ·å¼å†…å®¹ */
.container {
  padding: 20px;
}
</style>
```

---

## åç«¯å¼€å‘

### 1. æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

**æ­¥éª¤ä¸€ï¼šå®šä¹‰Modelï¼ˆmodels.pyï¼‰**

```python
class NewModel(Base):
    __tablename__ = "new_table"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(100), nullable=False, comment="åç§°")
    description = Column(Text, comment="æè¿°")
    created_at = Column(DateTime, server_default=func.now())
    updated_at = Column(DateTime, server_default=func.now(), onupdate=func.now())
```

**æ­¥éª¤äºŒï¼šå®šä¹‰Schemaï¼ˆschemas.pyï¼‰**

```python
# PydanticåŸºç¡€æ¨¡å‹
class NewModelBase(BaseModel):
    name: str
    description: Optional[str] = None

# åˆ›å»ºæ—¶ä½¿ç”¨
class NewModelCreate(NewModelBase):
    pass

# æ›´æ–°æ—¶ä½¿ç”¨
class NewModelUpdate(BaseModel):
    name: Optional[str] = None
    description: Optional[str] = None

# è¿”å›æ—¶ä½¿ç”¨
class NewModelResponse(NewModelBase):
    id: int
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True  # Pydantic v2è¯­æ³•
```

**æ­¥éª¤ä¸‰ï¼šåˆ›å»ºCRUDæ“ä½œï¼ˆcrud/new_model.pyï¼‰**

```python
from sqlalchemy.orm import Session
from models import NewModel
from schemas import NewModelCreate, NewModelUpdate

def get_list(db: Session, skip: int = 0, limit: int = 100):
    """è·å–åˆ—è¡¨"""
    return db.query(NewModel).offset(skip).limit(limit).all()

def get_by_id(db: Session, id: int):
    """æ ¹æ®IDè·å–"""
    return db.query(NewModel).filter(NewModel.id == id).first()

def create(db: Session, obj: NewModelCreate):
    """åˆ›å»º"""
    db_obj = NewModel(**obj.dict())
    db.add(db_obj)
    db.commit()
    db.refresh(db_obj)
    return db_obj

def update(db: Session, id: int, obj: NewModelUpdate):
    """æ›´æ–°"""
    db_obj = get_by_id(db, id)
    if db_obj:
        for key, value in obj.dict(exclude_unset=True).items():
            setattr(db_obj, key, value)
        db.commit()
        db.refresh(db_obj)
    return db_obj

def delete(db: Session, id: int):
    """åˆ é™¤"""
    db_obj = get_by_id(db, id)
    if db_obj:
        db.delete(db_obj)
        db.commit()
    return db_obj
```

**æ­¥éª¤å››ï¼šåˆ›å»ºè·¯ç”±ï¼ˆrouters/new_model.pyï¼‰**

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List
from database import get_db
from utils.security import get_current_user
from crud import new_model as crud
from schemas import NewModelCreate, NewModelUpdate, NewModelResponse
from models import User

router = APIRouter()

@router.get("/", response_model=List[NewModelResponse])
def get_list(
    skip: int = 0,
    limit: int = 100,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–åˆ—è¡¨"""
    return crud.get_list(db, skip, limit)

@router.get("/{id}", response_model=NewModelResponse)
def get_by_id(
    id: int,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–è¯¦æƒ…"""
    obj = crud.get_by_id(db, id)
    if not obj:
        raise HTTPException(status_code=404, detail="Not found")
    return obj

@router.post("/", response_model=NewModelResponse)
def create(
    obj: NewModelCreate,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """åˆ›å»º"""
    return crud.create(db, obj)

@router.put("/{id}", response_model=NewModelResponse)
def update(
    id: int,
    obj: NewModelUpdate,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """æ›´æ–°"""
    db_obj = crud.update(db, id, obj)
    if not db_obj:
        raise HTTPException(status_code=404, detail="Not found")
    return db_obj

@router.delete("/{id}")
def delete(
    id: int,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """åˆ é™¤"""
    crud.delete(db, id)
    return {"message": "åˆ é™¤æˆåŠŸ"}
```

**æ­¥éª¤äº”ï¼šæ³¨å†Œè·¯ç”±ï¼ˆmain.pyï¼‰**

```python
from routers import new_model

app.include_router(
    new_model.router,
    prefix="/api/new_models",
    tags=["æ–°æ¨¡å—"]
)
```

### 2. æ·»åŠ æƒé™éªŒè¯

```python
from utils.security import get_current_user, require_admin

# éœ€è¦ç™»å½•
@router.get("/")
def get_list(current_user: User = Depends(get_current_user)):
    # current_useræ˜¯å·²è®¤è¯çš„ç”¨æˆ·å¯¹è±¡
    pass

# éœ€è¦ç®¡ç†å‘˜æƒé™
@router.post("/")
def create(current_user: User = Depends(require_admin)):
    # åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
    pass

# è‡ªå®šä¹‰æƒé™éªŒè¯
def require_owner(
    id: int,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è¦æ±‚æ˜¯èµ„æºæ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜"""
    obj = crud.get_by_id(db, id)
    if not obj:
        raise HTTPException(status_code=404, detail="Not found")
    
    if current_user.role != "ç®¡ç†å‘˜" and obj.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="æƒé™ä¸è¶³")
    
    return obj

@router.put("/{id}")
def update(
    id: int,
    obj: NewModelUpdate,
    db_obj = Depends(require_owner)
):
    # db_objæ˜¯éªŒè¯é€šè¿‡çš„å¯¹è±¡
    pass
```

### 3. æ·»åŠ å®¡è®¡æ—¥å¿—

```python
from fastapi import Request
from utils.audit import AuditLogger
from utils.timer import Timer

@router.post("/", response_model=NewModelResponse)
def create(
    obj: NewModelCreate,
    request: Request,  # æ³¨å…¥Requestå¯¹è±¡
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    timer = Timer()
    timer.start()
    
    try:
        # åˆ›å»ºå¯¹è±¡
        db_obj = crud.create(db, obj)
        
        # è®°å½•å®¡è®¡æ—¥å¿—
        AuditLogger.log_create(
            db=db,
            user_id=current_user.id,
            username=current_user.username,
            module="new_model",
            resource_type="æ–°æ¨¡å—",
            resource_id=db_obj.id,
            request=request,
            data={"name": obj.name}
        )
        
        return db_obj
    except Exception as e:
        # è®°å½•å¤±è´¥æ—¥å¿—
        AuditLogger.log_operation(
            db=db,
            user_id=current_user.id,
            username=current_user.username,
            operation="åˆ›å»ºå¤±è´¥",
            module="new_model",
            request=request,
            status="FAILED",
            error_msg=str(e),
            duration=timer.elapsed_ms()
        )
        raise
```

---

## å‰ç«¯å¼€å‘

### 1. æ·»åŠ æ–°é¡µé¢

**æ­¥éª¤ä¸€ï¼šåˆ›å»ºAPIæœåŠ¡ï¼ˆservices/new_model.jsï¼‰**

```javascript
import request from './request'

// è·å–åˆ—è¡¨
export const getList = (params) => {
  return request.get('/api/new_models', { params })
}

// è·å–è¯¦æƒ…
export const getById = (id) => {
  return request.get(`/api/new_models/${id}`)
}

// åˆ›å»º
export const create = (data) => {
  return request.post('/api/new_models', data)
}

// æ›´æ–°
export const update = (id, data) => {
  return request.put(`/api/new_models/${id}`, data)
}

// åˆ é™¤
export const deleteItem = (id) => {
  return request.delete(`/api/new_models/${id}`)
}
```

**æ­¥éª¤äºŒï¼šåˆ›å»ºé¡µé¢ç»„ä»¶ï¼ˆviews/new_model/index.vueï¼‰**

```vue
<template>
  <div class="container">
    <!-- æœç´¢åŒºåŸŸ -->
    <el-card shadow="never" style="margin-bottom: 20px;">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="åç§°">
          <el-input v-model="searchForm.name" placeholder="è¯·è¾“å…¥åç§°" clearable />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">æœç´¢</el-button>
          <el-button @click="handleReset">é‡ç½®</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- è¡¨æ ¼åŒºåŸŸ -->
    <el-card shadow="never">
      <template #header>
        <div class="card-header">
          <span>æ•°æ®åˆ—è¡¨</span>
          <el-button type="primary" @click="handleAdd">æ–°å¢</el-button>
        </div>
      </template>

      <el-table :data="tableData" v-loading="loading" border>
        <el-table-column prop="id" label="ID" width="60" />
        <el-table-column prop="name" label="åç§°" min-width="150" />
        <el-table-column prop="description" label="æè¿°" min-width="200" />
        <el-table-column prop="created_at" label="åˆ›å»ºæ—¶é—´" width="180" />
        <el-table-column label="æ“ä½œ" width="180" fixed="right">
          <template #default="{ row }">
            <el-button link type="primary" @click="handleEdit(row)">ç¼–è¾‘</el-button>
            <el-button link type="danger" @click="handleDelete(row)">åˆ é™¤</el-button>
          </template>
        </el-table-column>
      </el-table>

      <!-- åˆ†é¡µ -->
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="loadData"
        @current-change="loadData"
        style="margin-top: 20px; justify-content: flex-end;"
      />
    </el-card>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <el-dialog
      v-model="dialogVisible"
      :title="dialogTitle"
      width="600px"
      @close="handleClose"
    >
      <el-form
        ref="formRef"
        :model="form"
        :rules="rules"
        label-width="100px"
      >
        <el-form-item label="åç§°" prop="name">
          <el-input v-model="form.name" placeholder="è¯·è¾“å…¥åç§°" />
        </el-form-item>
        <el-form-item label="æè¿°" prop="description">
          <el-input
            v-model="form.description"
            type="textarea"
            :rows="4"
            placeholder="è¯·è¾“å…¥æè¿°"
          />
        </el-form-item>
      </el-form>

      <template #footer>
        <el-button @click="dialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="handleSubmit" :loading="submitting">
          ç¡®å®š
        </el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { getList, create, update, deleteItem } from '@/services/new_model'

// æœç´¢è¡¨å•
const searchForm = reactive({
  name: ''
})

// è¡¨æ ¼æ•°æ®
const tableData = ref([])
const loading = ref(false)

// åˆ†é¡µ
const pagination = reactive({
  page: 1,
  size: 20,
  total: 0
})

// å¯¹è¯æ¡†
const dialogVisible = ref(false)
const dialogTitle = computed(() => form.id ? 'ç¼–è¾‘' : 'æ–°å¢')
const formRef = ref(null)
const form = reactive({
  id: null,
  name: '',
  description: ''
})
const submitting = ref(false)

// è¡¨å•éªŒè¯è§„åˆ™
const rules = {
  name: [
    { required: true, message: 'è¯·è¾“å…¥åç§°', trigger: 'blur' },
    { min: 2, max: 50, message: 'é•¿åº¦åœ¨ 2 åˆ° 50 ä¸ªå­—ç¬¦', trigger: 'blur' }
  ]
}

// åŠ è½½æ•°æ®
const loadData = async () => {
  loading.value = true
  try {
    const params = {
      skip: (pagination.page - 1) * pagination.size,
      limit: pagination.size,
      ...searchForm
    }
    const res = await getList(params)
    tableData.value = res
    pagination.total = res.length
  } catch (error) {
    ElMessage.error('åŠ è½½æ•°æ®å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// æœç´¢
const handleSearch = () => {
  pagination.page = 1
  loadData()
}

// é‡ç½®
const handleReset = () => {
  searchForm.name = ''
  handleSearch()
}

// æ–°å¢
const handleAdd = () => {
  Object.assign(form, {
    id: null,
    name: '',
    description: ''
  })
  dialogVisible.value = true
}

// ç¼–è¾‘
const handleEdit = (row) => {
  Object.assign(form, row)
  dialogVisible.value = true
}

// åˆ é™¤
const handleDelete = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ', 'æç¤º', {
      type: 'warning'
    })
    await deleteItem(row.id)
    ElMessage.success('åˆ é™¤æˆåŠŸ')
    loadData()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}

// æäº¤
const handleSubmit = async () => {
  try {
    await formRef.value.validate()
    submitting.value = true
    
    if (form.id) {
      await update(form.id, form)
      ElMessage.success('æ›´æ–°æˆåŠŸ')
    } else {
      await create(form)
      ElMessage.success('åˆ›å»ºæˆåŠŸ')
    }
    
    dialogVisible.value = false
    loadData()
  } catch (error) {
    if (error !== false) {
      ElMessage.error('æäº¤å¤±è´¥')
    }
  } finally {
    submitting.value = false
  }
}

// å…³é—­å¯¹è¯æ¡†
const handleClose = () => {
  formRef.value?.resetFields()
}

// åˆå§‹åŒ–
onMounted(() => {
  loadData()
})
</script>

<style scoped>
.container {
  padding: 20px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
```

**æ­¥éª¤ä¸‰ï¼šæ·»åŠ è·¯ç”±ï¼ˆrouter/index.jsï¼‰**

```javascript
{
  path: 'new_model',
  name: 'NewModel',
  component: () => import('../views/new_model/index.vue'),
  meta: { title: 'æ–°æ¨¡å—', icon: 'Document' }
}
```

### 2. çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

```javascript
// store/new_model.js
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useNewModelStore = defineStore('newModel', () => {
  // çŠ¶æ€
  const list = ref([])
  const current = ref(null)

  // æ–¹æ³•
  const setList = (data) => {
    list.value = data
  }

  const setCurrent = (data) => {
    current.value = data
  }

  const clear = () => {
    list.value = []
    current.value = null
  }

  return {
    list,
    current,
    setList,
    setCurrent,
    clear
  }
})
```

---

## APIæ–‡æ¡£

### è®¿é—®Swaggeræ–‡æ¡£

ç³»ç»Ÿå¯åŠ¨åï¼Œè®¿é—®ï¼šhttp://localhost:8000/api/docs

### APIè§„èŒƒ

#### è¯·æ±‚æ ¼å¼

```
GET /api/projects?skip=0&limit=20
Content-Type: application/json
Authorization: Bearer <token>
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "id": 1,
  "project_name": "é¡¹ç›®åç§°",
  "status": "æ‰§è¡Œä¸­"
}
```

**é”™è¯¯å“åº”**:
```json
{
  "detail": "é”™è¯¯ä¿¡æ¯"
}
```

#### çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªè®¤è¯ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## æµ‹è¯•æŒ‡å—

### åç«¯æµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-cov

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_user.py

# æŸ¥çœ‹è¦†ç›–ç‡
pytest --cov=. --cov-report=html
```

**æµ‹è¯•ç¤ºä¾‹**:
```python
# tests/test_user.py
import pytest
from fastapi.testclient import TestClient
from main import app

client = TestClient(app)

def test_create_user():
    response = client.post(
        "/api/users/",
        json={
            "username": "test",
            "password": "Test@123",
            "name": "æµ‹è¯•ç”¨æˆ·"
        },
        headers={"Authorization": f"Bearer {admin_token}"}
    )
    assert response.status_code == 200
    assert response.json()["username"] == "test"
```

### å‰ç«¯æµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
npm install --save-dev @vue/test-utils vitest

# è¿è¡Œæµ‹è¯•
npm run test
```

---

## è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•

**ä½¿ç”¨printè°ƒè¯•**:
```python
print(f"Debug: user_id={user_id}, role={current_user.role}")
```

**ä½¿ç”¨æ—¥å¿—**:
```python
import logging
logger = logging.getLogger(__name__)

logger.info(f"User {user.username} created")
logger.error(f"Failed to create user: {e}")
```

**ä½¿ç”¨IDEæ–­ç‚¹**: PyCharmæ”¯æŒç›´æ¥åœ¨ä»£ç è¡Œæ‰“æ–­ç‚¹

### å‰ç«¯è°ƒè¯•

**ä½¿ç”¨console**:
```javascript
console.log('Debug:', tableData.value)
console.error('Error:', error)
```

**ä½¿ç”¨Vue DevTools**: æµè§ˆå™¨å®‰è£…Vue DevToolsæ’ä»¶

**æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**: F12 â†’ Network â†’ XHR

---

## å¸¸è§é—®é¢˜

### 1. CORSè·¨åŸŸé—®é¢˜

**é—®é¢˜**: å‰ç«¯æ— æ³•è®¿é—®åç«¯API

**è§£å†³**: æ£€æŸ¥ `main.py` çš„CORSé…ç½®
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: `Can't connect to MySQL server`

**è§£å†³**: æ£€æŸ¥ `database.py` é…ç½®
```python
MYSQL_USER = "root"
MYSQL_PASSWORD = "your_password"
MYSQL_HOST = "localhost"
```

### 3. Tokenè¿‡æœŸ

**é—®é¢˜**: è¯·æ±‚è¿”å›401

**è§£å†³**: å‰ç«¯è‡ªåŠ¨åˆ·æ–°tokenæˆ–é‡æ–°ç™»å½•
```javascript
// request.js å“åº”æ‹¦æˆªå™¨
if (response.status === 401) {
  localStorage.removeItem('token')
  router.push('/login')
}
```

---

**å¼€å‘æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜è¯·æŸ¥é˜…æ–‡æ¡£æˆ–æäº¤Issueã€‚** ğŸš€
