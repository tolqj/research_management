# æ•°æ®åº“è®¾è®¡æ–‡æ¡£

> ç§‘ç ”ç®¡ç†ç³»ç»Ÿæ•°æ®åº“è¡¨ç»“æ„å®Œæ•´è¯´æ˜

## ğŸ“‹ ç›®å½•

- [æ•°æ®åº“æ¦‚è¿°](#æ•°æ®åº“æ¦‚è¿°)
- [è¡¨ç»“æ„è®¾è®¡](#è¡¨ç»“æ„è®¾è®¡)
  - [ç”¨æˆ·è¡¨ (users)](#ç”¨æˆ·è¡¨-users)
  - [é¡¹ç›®è¡¨ (projects)](#é¡¹ç›®è¡¨-projects)
  - [è®ºæ–‡è¡¨ (papers)](#è®ºæ–‡è¡¨-papers)
  - [ç»è´¹è¡¨ (funds)](#ç»è´¹è¡¨-funds)
  - [æˆæœè¡¨ (achievements)](#æˆæœè¡¨-achievements)
  - [æ“ä½œæ—¥å¿—è¡¨ (operation_logs)](#æ“ä½œæ—¥å¿—è¡¨-operation_logs)
- [è¡¨å…³ç³»å›¾](#è¡¨å…³ç³»å›¾)
- [ç´¢å¼•è®¾è®¡](#ç´¢å¼•è®¾è®¡)
- [å¸¸ç”¨SQLç¤ºä¾‹](#å¸¸ç”¨sqlç¤ºä¾‹)
- [æ•°æ®å­—å…¸](#æ•°æ®å­—å…¸)

---

## æ•°æ®åº“æ¦‚è¿°

### åŸºæœ¬ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|-----|
| æ•°æ®åº“åç§° | research_management_system |
| å­—ç¬¦é›† | utf8mb4 |
| æ’åºè§„åˆ™ | utf8mb4_unicode_ci |
| æ•°æ®åº“ç‰ˆæœ¬ | MySQL 8.0+ |
| å­˜å‚¨å¼•æ“ | InnoDB |
| æ ¸å¿ƒè¡¨æ•°é‡ | 6å¼  |

### è®¾è®¡åŸåˆ™

1. **ç¬¦åˆç­‰ä¿äºŒçº§æ ‡å‡†** - å®Œæ•´çš„å®¡è®¡æ—¥å¿—å’Œå®‰å…¨å­—æ®µ
2. **å¤–é”®çº¦æŸ** - ä¿è¯æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
3. **å­—æ®µæ³¨é‡Š** - æ‰€æœ‰å­—æ®µéƒ½æœ‰ä¸­æ–‡è¯´æ˜
4. **æ—¶é—´æˆ³** - è‡ªåŠ¨è®°å½•åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
5. **ç´¢å¼•ä¼˜åŒ–** - å¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•

---

## è¡¨ç»“æ„è®¾è®¡

### ç”¨æˆ·è¡¨ (users)

å­˜å‚¨ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼Œæ”¯æŒä¸‰ç§è§’è‰²ï¼ˆç®¡ç†å‘˜ã€ç§‘ç ”ç§˜ä¹¦ã€æ™®é€šæ•™å¸ˆï¼‰ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE users (
    -- åŸºæœ¬ä¿¡æ¯
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œå€¼',
    name VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    role ENUM('ç®¡ç†å‘˜', 'ç§‘ç ”ç§˜ä¹¦', 'æ™®é€šæ•™å¸ˆ') DEFAULT 'æ™®é€šæ•™å¸ˆ' COMMENT 'ç”¨æˆ·è§’è‰²',
    title VARCHAR(50) COMMENT 'èŒç§°ï¼ˆæ•™æˆ/å‰¯æ•™æˆ/è®²å¸ˆç­‰ï¼‰',
    college VARCHAR(100) COMMENT 'æ‰€å±å­¦é™¢',
    email VARCHAR(100) UNIQUE COMMENT 'ç”µå­é‚®ç®±',
    phone VARCHAR(20) COMMENT 'è”ç³»ç”µè¯',
    research_field VARCHAR(200) COMMENT 'ç ”ç©¶æ–¹å‘',
    
    -- å®‰å…¨å­—æ®µï¼ˆç­‰ä¿äºŒçº§è¦æ±‚ï¼‰
    password_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'å¯†ç æœ€åä¿®æ”¹æ—¶é—´',
    login_failures INT DEFAULT 0 COMMENT 'è¿ç»­ç™»å½•å¤±è´¥æ¬¡æ•°',
    locked_until DATETIME COMMENT 'è´¦å·é”å®šæˆªæ­¢æ—¶é—´',
    last_login_at DATETIME COMMENT 'æœ€åç™»å½•æ—¶é—´',
    last_login_ip VARCHAR(50) COMMENT 'æœ€åç™»å½•IPåœ°å€',
    
    -- æ—¶é—´æˆ³
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_username (username),
    INDEX idx_role (role),
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”®ï¼Œè‡ªå¢ | 1 |
| username | VARCHAR(50) | æ˜¯ | å”¯ä¸€ç”¨æˆ·åï¼Œç”¨äºç™»å½• | admin |
| password_hash | VARCHAR(255) | æ˜¯ | å¯†ç å“ˆå¸Œå€¼ï¼ˆbcryptåŠ å¯†ï¼‰ | $2b$12$... |
| name | VARCHAR(50) | æ˜¯ | çœŸå®å§“å | å¼ æ•™æˆ |
| role | ENUM | å¦ | ç”¨æˆ·è§’è‰² | ç®¡ç†å‘˜ |
| title | VARCHAR(50) | å¦ | èŒç§° | æ•™æˆ |
| college | VARCHAR(100) | å¦ | æ‰€å±å­¦é™¢ | è®¡ç®—æœºå­¦é™¢ |
| email | VARCHAR(100) | å¦ | ç”µå­é‚®ç®±ï¼Œå”¯ä¸€ | admin@example.com |
| phone | VARCHAR(20) | å¦ | è”ç³»ç”µè¯ | 13800138000 |
| research_field | VARCHAR(200) | å¦ | ç ”ç©¶æ–¹å‘ | äººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹  |
| password_updated_at | DATETIME | å¦ | å¯†ç ä¿®æ”¹æ—¶é—´ï¼Œç”¨äºå¼ºåˆ¶å®šæœŸæ›´æ¢ | 2024-01-01 10:00:00 |
| login_failures | INT | å¦ | ç™»å½•å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡5æ¬¡é”å®š | 0 |
| locked_until | DATETIME | å¦ | é”å®šæˆªæ­¢æ—¶é—´ | 2024-01-01 10:30:00 |
| last_login_at | DATETIME | å¦ | æœ€åç™»å½•æ—¶é—´ | 2024-12-02 09:00:00 |
| last_login_ip | VARCHAR(50) | å¦ | æœ€åç™»å½•IP | 192.168.1.100 |

#### è§’è‰²æƒé™è¯´æ˜

| è§’è‰² | æƒé™ |
|------|------|
| ç®¡ç†å‘˜ | æ‰€æœ‰åŠŸèƒ½ï¼ˆç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿé…ç½®ï¼‰ |
| ç§‘ç ”ç§˜ä¹¦ | æŸ¥çœ‹æ‰€æœ‰æ•°æ®ã€ç»Ÿè®¡åˆ†æ |
| æ™®é€šæ•™å¸ˆ | ç®¡ç†è‡ªå·±çš„é¡¹ç›®ã€è®ºæ–‡ã€ç»è´¹ã€æˆæœ |

---

### é¡¹ç›®è¡¨ (projects)

å­˜å‚¨ç§‘ç ”é¡¹ç›®ä¿¡æ¯ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE projects (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'é¡¹ç›®ID',
    project_name VARCHAR(200) NOT NULL COMMENT 'é¡¹ç›®åç§°',
    pi_id INT NOT NULL COMMENT 'é¡¹ç›®è´Ÿè´£äººID',
    pi_name VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®è´Ÿè´£äººå§“å',
    members TEXT COMMENT 'é¡¹ç›®æˆå‘˜ï¼ˆJSONæ•°ç»„ï¼‰',
    project_type VARCHAR(100) COMMENT 'é¡¹ç›®ç±»å‹',
    source VARCHAR(100) COMMENT 'é¡¹ç›®æ¥æº',
    budget_total FLOAT DEFAULT 0.0 COMMENT 'æ€»é¢„ç®—ï¼ˆå…ƒï¼‰',
    start_date DATE COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE COMMENT 'ç»“æŸæ—¥æœŸ',
    status ENUM('è‰ç¨¿', 'å·²ç”³æŠ¥', 'å·²æ‰¹å‡†', 'æ‰§è¡Œä¸­', 'ä¸­æœŸæ£€æŸ¥', 'å·²ç»“é¢˜', 'å·²æ‹’ç»') DEFAULT 'è‰ç¨¿' COMMENT 'é¡¹ç›®çŠ¶æ€',
    description TEXT COMMENT 'é¡¹ç›®æè¿°',
    objectives TEXT COMMENT 'ç ”ç©¶ç›®æ ‡',
    attachments TEXT COMMENT 'é™„ä»¶åˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (pi_id) REFERENCES users(id) ON DELETE RESTRICT,
    INDEX idx_pi_id (pi_id),
    INDEX idx_status (status),
    INDEX idx_project_type (project_type),
    INDEX idx_start_date (start_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç§‘ç ”é¡¹ç›®è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”® | 1 |
| project_name | VARCHAR(200) | æ˜¯ | é¡¹ç›®åç§° | åŸºäºæ·±åº¦å­¦ä¹ çš„å›¾åƒè¯†åˆ«ç ”ç©¶ |
| pi_id | INT | æ˜¯ | è´Ÿè´£äººIDï¼ˆå¤–é”®ï¼‰ | 1 |
| pi_name | VARCHAR(50) | æ˜¯ | è´Ÿè´£äººå§“åï¼ˆå†—ä½™å­—æ®µï¼‰ | å¼ æ•™æˆ |
| members | TEXT | å¦ | æˆå‘˜JSONæ•°ç»„ | ["å¼ æ•™æˆ", "æå‰¯æ•™æˆ"] |
| project_type | VARCHAR(100) | å¦ | é¡¹ç›®ç±»å‹ | å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘ |
| source | VARCHAR(100) | å¦ | é¡¹ç›®æ¥æº | å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘å§” |
| budget_total | FLOAT | å¦ | æ€»é¢„ç®— | 500000.0 |
| start_date | DATE | å¦ | å¼€å§‹æ—¥æœŸ | 2023-01-01 |
| end_date | DATE | å¦ | ç»“æŸæ—¥æœŸ | 2025-12-31 |
| status | ENUM | å¦ | é¡¹ç›®çŠ¶æ€ | æ‰§è¡Œä¸­ |
| description | TEXT | å¦ | é¡¹ç›®æè¿° | ç ”ç©¶æ·±åº¦å­¦ä¹ ... |
| objectives | TEXT | å¦ | ç ”ç©¶ç›®æ ‡ | æå‡ºæ–°ç®—æ³•... |
| attachments | TEXT | å¦ | é™„ä»¶JSONæ•°ç»„ | [{"name": "ç”³æŠ¥ä¹¦.pdf"}] |

#### é¡¹ç›®çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| è‰ç¨¿ | é¡¹ç›®ä¿¡æ¯æœªå®Œæˆï¼Œæœªæäº¤ |
| å·²ç”³æŠ¥ | å·²æäº¤ç”³æŠ¥ææ–™ |
| å·²æ‰¹å‡† | ç”³æŠ¥é€šè¿‡ï¼Œç­‰å¾…å¯åŠ¨ |
| æ‰§è¡Œä¸­ | é¡¹ç›®æ­£åœ¨æ‰§è¡Œ |
| ä¸­æœŸæ£€æŸ¥ | è¿›è¡Œä¸­æœŸæ£€æŸ¥ |
| å·²ç»“é¢˜ | é¡¹ç›®å®Œæˆ |
| å·²æ‹’ç» | ç”³æŠ¥æœªé€šè¿‡ |

---

### è®ºæ–‡è¡¨ (papers)

å­˜å‚¨å­¦æœ¯è®ºæ–‡å‘è¡¨ä¿¡æ¯ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE papers (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®ºæ–‡ID',
    title VARCHAR(300) NOT NULL COMMENT 'è®ºæ–‡æ ‡é¢˜',
    authors VARCHAR(500) NOT NULL COMMENT 'ä½œè€…åˆ—è¡¨',
    journal VARCHAR(200) COMMENT 'æœŸåˆŠåç§°',
    publication_date DATE COMMENT 'å‘è¡¨æ—¥æœŸ',
    doi VARCHAR(100) COMMENT 'DOIå·',
    jcr_zone VARCHAR(10) COMMENT 'JCRåˆ†åŒº',
    cas_zone VARCHAR(10) COMMENT 'ä¸­ç§‘é™¢åˆ†åŒº',
    impact_factor FLOAT COMMENT 'å½±å“å› å­',
    project_id INT COMMENT 'å…³è”é¡¹ç›®ID',
    creator_id INT COMMENT 'å½•å…¥äººID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE SET NULL,
    FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_project_id (project_id),
    INDEX idx_creator_id (creator_id),
    INDEX idx_publication_date (publication_date),
    INDEX idx_jcr_zone (jcr_zone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å­¦æœ¯è®ºæ–‡è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”® | 1 |
| title | VARCHAR(300) | æ˜¯ | è®ºæ–‡æ ‡é¢˜ | Deep Learning for Image... |
| authors | VARCHAR(500) | æ˜¯ | ä½œè€…åˆ—è¡¨ | å¼ æ•™æˆ, æå‰¯æ•™æˆ |
| journal | VARCHAR(200) | å¦ | æœŸåˆŠåç§° | IEEE TPAMI |
| publication_date | DATE | å¦ | å‘è¡¨æ—¥æœŸ | 2024-03-15 |
| doi | VARCHAR(100) | å¦ | æ•°å­—å¯¹è±¡æ ‡è¯†ç¬¦ | 10.1109/TPAMI.2024.001 |
| jcr_zone | VARCHAR(10) | å¦ | JCRåˆ†åŒº | Q1 |
| cas_zone | VARCHAR(10) | å¦ | ä¸­ç§‘é™¢åˆ†åŒº | ä¸€åŒº |
| impact_factor | FLOAT | å¦ | å½±å“å› å­ | 24.5 |
| project_id | INT | å¦ | å…³è”é¡¹ç›®ID | 1 |
| creator_id | INT | å¦ | å½•å…¥äººID | 1 |

#### åˆ†åŒºè¯´æ˜

**JCRåˆ†åŒº**: Q1ï¼ˆå‰25%ï¼‰ã€Q2ï¼ˆ25-50%ï¼‰ã€Q3ï¼ˆ50-75%ï¼‰ã€Q4ï¼ˆå25%ï¼‰  
**ä¸­ç§‘é™¢åˆ†åŒº**: ä¸€åŒºï¼ˆé¡¶çº§ï¼‰ã€äºŒåŒºã€ä¸‰åŒºã€å››åŒº

---

### ç»è´¹è¡¨ (funds)

å­˜å‚¨ç§‘ç ”ç»è´¹æ”¯å‡ºè®°å½•ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE funds (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç»è´¹è®°å½•ID',
    project_id INT NOT NULL COMMENT 'é¡¹ç›®ID',
    expense_type VARCHAR(100) NOT NULL COMMENT 'æ”¯å‡ºç±»å‹',
    amount FLOAT NOT NULL COMMENT 'é‡‘é¢ï¼ˆå…ƒï¼‰',
    expense_date DATE NOT NULL COMMENT 'æ”¯å‡ºæ—¥æœŸ',
    handler VARCHAR(50) COMMENT 'ç»åŠäºº',
    notes TEXT COMMENT 'å¤‡æ³¨è¯´æ˜',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    INDEX idx_project_id (project_id),
    INDEX idx_expense_type (expense_type),
    INDEX idx_expense_date (expense_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç§‘ç ”ç»è´¹è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”® | 1 |
| project_id | INT | æ˜¯ | é¡¹ç›®IDï¼ˆå¤–é”®ï¼‰ | 1 |
| expense_type | VARCHAR(100) | æ˜¯ | æ”¯å‡ºç±»å‹ | è®¾å¤‡è´¹ |
| amount | FLOAT | æ˜¯ | é‡‘é¢ | 150000.0 |
| expense_date | DATE | æ˜¯ | æ”¯å‡ºæ—¥æœŸ | 2024-01-15 |
| handler | VARCHAR(50) | å¦ | ç»åŠäºº | å¼ æ•™æˆ |
| notes | TEXT | å¦ | å¤‡æ³¨ | è´­ä¹°GPUæœåŠ¡å™¨ |

#### å¸¸è§æ”¯å‡ºç±»å‹

- è®¾å¤‡è´¹
- å·®æ—…è´¹
- ä¼šè®®è´¹
- ææ–™è´¹
- åŠ³åŠ¡è´¹
- å‡ºç‰ˆè´¹
- å…¶ä»–

---

### æˆæœè¡¨ (achievements)

å­˜å‚¨ç§‘ç ”æˆæœä¿¡æ¯ï¼ˆä¸“åˆ©ã€å¥–é¡¹ã€è‘—ä½œã€è½¯è‘—ï¼‰ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE achievements (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'æˆæœID',
    achievement_type ENUM('ä¸“åˆ©', 'å¥–é¡¹', 'è‘—ä½œ', 'è½¯ä»¶è‘—ä½œæƒ') NOT NULL COMMENT 'æˆæœç±»å‹',
    title VARCHAR(200) NOT NULL COMMENT 'æˆæœåç§°',
    owner VARCHAR(100) NOT NULL COMMENT 'æˆæœæ‰€æœ‰äºº',
    members VARCHAR(500) COMMENT 'å‚ä¸äººå‘˜',
    completion_date DATE COMMENT 'å®Œæˆæ—¥æœŸ',
    certificate_no VARCHAR(100) COMMENT 'è¯ä¹¦ç¼–å·',
    description TEXT COMMENT 'æˆæœæè¿°',
    attachments TEXT COMMENT 'é™„ä»¶åˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_achievement_type (achievement_type),
    INDEX idx_owner (owner),
    INDEX idx_completion_date (completion_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç§‘ç ”æˆæœè¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”® | 1 |
| achievement_type | ENUM | æ˜¯ | æˆæœç±»å‹ | ä¸“åˆ© |
| title | VARCHAR(200) | æ˜¯ | æˆæœåç§° | ä¸€ç§åŸºäºæ·±åº¦å­¦ä¹ çš„... |
| owner | VARCHAR(100) | æ˜¯ | æˆæœæ‰€æœ‰äºº | å¼ æ•™æˆ |
| members | VARCHAR(500) | å¦ | å‚ä¸äººå‘˜ | å¼ æ•™æˆ, æå‰¯æ•™æˆ |
| completion_date | DATE | å¦ | å®Œæˆæ—¥æœŸ | 2024-02-01 |
| certificate_no | VARCHAR(100) | å¦ | è¯ä¹¦ç¼–å· | CN202410001234.5 |
| description | TEXT | å¦ | æˆæœæè¿° | æœ¬å‘æ˜æå‡º... |
| attachments | TEXT | å¦ | é™„ä»¶JSON | [{"name": "ä¸“åˆ©è¯ä¹¦.pdf"}] |

---

### æ“ä½œæ—¥å¿—è¡¨ (operation_logs)

å­˜å‚¨ç”¨æˆ·æ“ä½œå®¡è®¡æ—¥å¿—ï¼Œç¬¦åˆç­‰ä¿äºŒçº§è¦æ±‚ã€‚

#### è¡¨ç»“æ„

```sql
CREATE TABLE operation_logs (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    user_id INT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) COMMENT 'ç”¨æˆ·å',
    operation VARCHAR(100) NOT NULL COMMENT 'æ“ä½œç±»å‹',
    module VARCHAR(50) NOT NULL COMMENT 'æ¨¡å—åç§°',
    method VARCHAR(10) COMMENT 'HTTPæ–¹æ³•',
    path VARCHAR(200) COMMENT 'è¯·æ±‚è·¯å¾„',
    details TEXT COMMENT 'æ“ä½œè¯¦æƒ…ï¼ˆJSONï¼‰',
    ip_address VARCHAR(50) NOT NULL COMMENT 'IPåœ°å€',
    user_agent VARCHAR(500) COMMENT 'ç”¨æˆ·ä»£ç†',
    status VARCHAR(20) COMMENT 'æ“ä½œç»“æœ',
    error_msg TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
    duration INT COMMENT 'æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at),
    INDEX idx_operation (operation),
    INDEX idx_module (module)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œæ—¥å¿—è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | INT | æ˜¯ | ä¸»é”® | 1 |
| user_id | INT | å¦ | ç”¨æˆ·ID | 1 |
| username | VARCHAR(50) | å¦ | ç”¨æˆ·å | admin |
| operation | VARCHAR(100) | æ˜¯ | æ“ä½œç±»å‹ | åˆ›å»ºé¡¹ç›® |
| module | VARCHAR(50) | æ˜¯ | æ¨¡å—åç§° | project |
| method | VARCHAR(10) | å¦ | HTTPæ–¹æ³• | POST |
| path | VARCHAR(200) | å¦ | è¯·æ±‚è·¯å¾„ | /api/projects |
| details | TEXT | å¦ | è¯¦æƒ…JSON | {"project_name": "..."} |
| ip_address | VARCHAR(50) | æ˜¯ | IPåœ°å€ | 192.168.1.100 |
| user_agent | VARCHAR(500) | å¦ | æµè§ˆå™¨ä¿¡æ¯ | Mozilla/5.0... |
| status | VARCHAR(20) | å¦ | æ“ä½œç»“æœ | SUCCESS |
| error_msg | TEXT | å¦ | é”™è¯¯ä¿¡æ¯ | null |
| duration | INT | å¦ | æ‰§è¡Œæ—¶é—´ | 156 |

#### æ“ä½œç±»å‹ç¤ºä¾‹

- ç™»å½•æˆåŠŸ / ç™»å½•å¤±è´¥
- åˆ›å»ºé¡¹ç›® / ç¼–è¾‘é¡¹ç›® / åˆ é™¤é¡¹ç›®
- åˆ›å»ºç”¨æˆ· / ç¼–è¾‘ç”¨æˆ· / åˆ é™¤ç”¨æˆ·
- ä¿®æ”¹å¯†ç 
- å¯¼å‡ºæ•°æ®

---

## è¡¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚
â”‚ (ç”¨æˆ·è¡¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ n
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚  projects   â”‚
â”‚ (é¡¹ç›®è¡¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ n         â”‚ n          â”‚ n
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   papers    â”‚ â”‚  funds   â”‚ â”‚achievementsâ”‚
â”‚ (è®ºæ–‡è¡¨)    â”‚ â”‚ (ç»è´¹è¡¨) â”‚ â”‚ (æˆæœè¡¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚operation_logsâ”‚
â”‚ (æ—¥å¿—è¡¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³ç³»è¯´æ˜

1. **users â†’ projects**: ä¸€å¯¹å¤šï¼ˆä¸€ä¸ªç”¨æˆ·å¯ä»¥è´Ÿè´£å¤šä¸ªé¡¹ç›®ï¼‰
2. **projects â†’ papers**: ä¸€å¯¹å¤šï¼ˆä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šç¯‡è®ºæ–‡ï¼‰
3. **projects â†’ funds**: ä¸€å¯¹å¤šï¼ˆä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šç¬”ç»è´¹æ”¯å‡ºï¼‰
4. **users â†’ papers**: ä¸€å¯¹å¤šï¼ˆä¸€ä¸ªç”¨æˆ·å¯ä»¥å½•å…¥å¤šç¯‡è®ºæ–‡ï¼‰
5. **users â†’ operation_logs**: ä¸€å¯¹å¤šï¼ˆä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡æ“ä½œæ—¥å¿—ï¼‰

---

## ç´¢å¼•è®¾è®¡

### ä¸»é”®ç´¢å¼•

æ‰€æœ‰è¡¨çš„ `id` å­—æ®µéƒ½æ˜¯ä¸»é”®ï¼Œè‡ªåŠ¨åˆ›å»ºèšç°‡ç´¢å¼•ã€‚

### å”¯ä¸€ç´¢å¼•

- `users.username` - ç”¨æˆ·åå”¯ä¸€
- `users.email` - é‚®ç®±å”¯ä¸€

### æ™®é€šç´¢å¼•

```sql
-- ç”¨æˆ·è¡¨
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_role ON users(role);
CREATE INDEX idx_email ON users(email);

-- é¡¹ç›®è¡¨
CREATE INDEX idx_pi_id ON projects(pi_id);
CREATE INDEX idx_status ON projects(status);
CREATE INDEX idx_project_type ON projects(project_type);
CREATE INDEX idx_start_date ON projects(start_date);

-- è®ºæ–‡è¡¨
CREATE INDEX idx_project_id ON papers(project_id);
CREATE INDEX idx_creator_id ON papers(creator_id);
CREATE INDEX idx_publication_date ON papers(publication_date);
CREATE INDEX idx_jcr_zone ON papers(jcr_zone);

-- ç»è´¹è¡¨
CREATE INDEX idx_project_id ON funds(project_id);
CREATE INDEX idx_expense_type ON funds(expense_type);
CREATE INDEX idx_expense_date ON funds(expense_date);

-- æˆæœè¡¨
CREATE INDEX idx_achievement_type ON achievements(achievement_type);
CREATE INDEX idx_owner ON achievements(owner);
CREATE INDEX idx_completion_date ON achievements(completion_date);

-- æ—¥å¿—è¡¨
CREATE INDEX idx_user_id ON operation_logs(user_id);
CREATE INDEX idx_created_at ON operation_logs(created_at);
CREATE INDEX idx_operation ON operation_logs(operation);
CREATE INDEX idx_module ON operation_logs(module);
```

---

## å¸¸ç”¨SQLç¤ºä¾‹

### 1. ç”¨æˆ·ç®¡ç†

```sql
-- åˆ›å»ºç”¨æˆ·
INSERT INTO users (username, password_hash, name, role, college, email)
VALUES ('teacher1', '$2b$12$...', 'ææ•™æˆ', 'æ™®é€šæ•™å¸ˆ', 'è®¡ç®—æœºå­¦é™¢', 'li@example.com');

-- æŸ¥è¯¢æ‰€æœ‰ç®¡ç†å‘˜
SELECT * FROM users WHERE role = 'ç®¡ç†å‘˜';

-- æ›´æ–°ç”¨æˆ·ä¿¡æ¯
UPDATE users SET phone = '13900139000' WHERE id = 1;

-- ç»Ÿè®¡å„å­¦é™¢ç”¨æˆ·æ•°
SELECT college, COUNT(*) as user_count 
FROM users 
GROUP BY college;
```

### 2. é¡¹ç›®ç®¡ç†

```sql
-- æŸ¥è¯¢æŸç”¨æˆ·è´Ÿè´£çš„æ‰€æœ‰æ‰§è¡Œä¸­é¡¹ç›®
SELECT * FROM projects 
WHERE pi_id = 1 AND status = 'æ‰§è¡Œä¸­'
ORDER BY start_date DESC;

-- ç»Ÿè®¡å„çŠ¶æ€é¡¹ç›®æ•°é‡
SELECT status, COUNT(*) as count 
FROM projects 
GROUP BY status;

-- æŸ¥è¯¢é¢„ç®—è¶…è¿‡50ä¸‡çš„é¡¹ç›®
SELECT project_name, budget_total, pi_name
FROM projects
WHERE budget_total > 500000
ORDER BY budget_total DESC;

-- æŸ¥è¯¢å³å°†ç»“é¢˜çš„é¡¹ç›®ï¼ˆ3ä¸ªæœˆå†…ï¼‰
SELECT * FROM projects
WHERE status = 'æ‰§è¡Œä¸­' 
AND end_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 3 MONTH);
```

### 3. è®ºæ–‡ç»Ÿè®¡

```sql
-- ç»Ÿè®¡å„åˆ†åŒºè®ºæ–‡æ•°é‡
SELECT jcr_zone, COUNT(*) as paper_count
FROM papers
WHERE jcr_zone IS NOT NULL
GROUP BY jcr_zone;

-- æŸ¥è¯¢é«˜å½±å“å› å­è®ºæ–‡ï¼ˆIF > 10ï¼‰
SELECT title, impact_factor, journal, publication_date
FROM papers
WHERE impact_factor > 10
ORDER BY impact_factor DESC;

-- ç»Ÿè®¡æŸé¡¹ç›®çš„è®ºæ–‡å‘è¡¨æƒ…å†µ
SELECT p.project_name, COUNT(pa.id) as paper_count, AVG(pa.impact_factor) as avg_if
FROM projects p
LEFT JOIN papers pa ON p.id = pa.project_id
WHERE p.id = 1
GROUP BY p.id;

-- æŸ¥è¯¢ä»Šå¹´å‘è¡¨çš„Q1è®ºæ–‡
SELECT * FROM papers
WHERE jcr_zone = 'Q1' 
AND YEAR(publication_date) = YEAR(CURDATE());
```

### 4. ç»è´¹ç®¡ç†

```sql
-- ç»Ÿè®¡æŸé¡¹ç›®çš„æ€»æ”¯å‡º
SELECT project_id, SUM(amount) as total_expense
FROM funds
WHERE project_id = 1;

-- ç»Ÿè®¡å„æ”¯å‡ºç±»å‹çš„é‡‘é¢
SELECT expense_type, SUM(amount) as total, COUNT(*) as count
FROM funds
GROUP BY expense_type
ORDER BY total DESC;

-- æŸ¥è¯¢æŸæ—¶é—´æ®µçš„ç»è´¹æ”¯å‡º
SELECT f.*, p.project_name
FROM funds f
JOIN projects p ON f.project_id = p.id
WHERE f.expense_date BETWEEN '2024-01-01' AND '2024-12-31';

-- æŸ¥è¯¢è¶…æ”¯é¡¹ç›®ï¼ˆæ”¯å‡º > é¢„ç®—ï¼‰
SELECT p.project_name, p.budget_total, SUM(f.amount) as total_expense
FROM projects p
LEFT JOIN funds f ON p.id = f.project_id
GROUP BY p.id
HAVING SUM(f.amount) > p.budget_total;
```

### 5. æˆæœç»Ÿè®¡

```sql
-- ç»Ÿè®¡å„ç±»å‹æˆæœæ•°é‡
SELECT achievement_type, COUNT(*) as count
FROM achievements
GROUP BY achievement_type;

-- æŸ¥è¯¢æŸäººçš„æ‰€æœ‰æˆæœ
SELECT * FROM achievements
WHERE owner = 'å¼ æ•™æˆ' OR members LIKE '%å¼ æ•™æˆ%'
ORDER BY completion_date DESC;

-- ç»Ÿè®¡ä»Šå¹´å®Œæˆçš„ä¸“åˆ©
SELECT * FROM achievements
WHERE achievement_type = 'ä¸“åˆ©'
AND YEAR(completion_date) = YEAR(CURDATE());
```

### 6. å®¡è®¡æ—¥å¿—

```sql
-- æŸ¥è¯¢æŸç”¨æˆ·çš„æ“ä½œè®°å½•
SELECT * FROM operation_logs
WHERE user_id = 1
ORDER BY created_at DESC
LIMIT 100;

-- ç»Ÿè®¡å„æ“ä½œç±»å‹çš„æ•°é‡
SELECT operation, COUNT(*) as count
FROM operation_logs
GROUP BY operation
ORDER BY count DESC;

-- æŸ¥è¯¢ç™»å½•å¤±è´¥è®°å½•
SELECT username, ip_address, created_at
FROM operation_logs
WHERE operation = 'ç™»å½•å¤±è´¥'
AND created_at > DATE_SUB(NOW(), INTERVAL 7 DAY);

-- æŸ¥è¯¢æ…¢æ“ä½œï¼ˆæ‰§è¡Œæ—¶é—´ > 1ç§’ï¼‰
SELECT * FROM operation_logs
WHERE duration > 1000
ORDER BY duration DESC;

-- æ¸…ç†90å¤©å‰çš„æ—¥å¿—
DELETE FROM operation_logs
WHERE created_at < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

### 7. ç»¼åˆæŸ¥è¯¢

```sql
-- æŸ¥è¯¢ç”¨æˆ·çš„å®Œæ•´é¡¹ç›®ä¿¡æ¯ï¼ˆåŒ…å«è®ºæ–‡å’Œç»è´¹ï¼‰
SELECT 
    p.project_name,
    p.budget_total,
    COUNT(DISTINCT pa.id) as paper_count,
    COUNT(DISTINCT f.id) as fund_count,
    SUM(f.amount) as total_expense
FROM projects p
LEFT JOIN papers pa ON p.id = pa.project_id
LEFT JOIN funds f ON p.id = f.project_id
WHERE p.pi_id = 1
GROUP BY p.id;

-- ç»Ÿè®¡ç”¨æˆ·çš„ç§‘ç ”ç»©æ•ˆ
SELECT 
    u.name,
    COUNT(DISTINCT p.id) as project_count,
    COUNT(DISTINCT pa.id) as paper_count,
    COUNT(DISTINCT a.id) as achievement_count
FROM users u
LEFT JOIN projects p ON u.id = p.pi_id
LEFT JOIN papers pa ON u.id = pa.creator_id
LEFT JOIN achievements a ON u.name = a.owner
WHERE u.id = 1
GROUP BY u.id;
```

---

## æ•°æ®å­—å…¸

### æšä¸¾å€¼å­—å…¸

#### ç”¨æˆ·è§’è‰² (UserRole)

| å€¼ | è¯´æ˜ | æƒé™çº§åˆ« |
|----|------|---------|
| ç®¡ç†å‘˜ | ç³»ç»Ÿç®¡ç†å‘˜ | æœ€é«˜ |
| ç§‘ç ”ç§˜ä¹¦ | ç§‘ç ”å¤„ç§˜ä¹¦ | ä¸­ |
| æ™®é€šæ•™å¸ˆ | æ™®é€šæ•™å¸ˆ | åŸºæœ¬ |

#### é¡¹ç›®çŠ¶æ€ (ProjectStatus)

| å€¼ | è¯´æ˜ | æµç¨‹é˜¶æ®µ |
|----|------|---------|
| è‰ç¨¿ | æœªå®Œæˆ | 1 |
| å·²ç”³æŠ¥ | å·²æäº¤ | 2 |
| å·²æ‰¹å‡† | å®¡æ‰¹é€šè¿‡ | 3 |
| æ‰§è¡Œä¸­ | æ­£åœ¨æ‰§è¡Œ | 4 |
| ä¸­æœŸæ£€æŸ¥ | ä¸­æœŸè¯„ä¼° | 5 |
| å·²ç»“é¢˜ | å·²å®Œæˆ | 6 |
| å·²æ‹’ç» | å®¡æ‰¹æ‹’ç» | - |

#### æˆæœç±»å‹ (AchievementType)

| å€¼ | è¯´æ˜ |
|----|------|
| ä¸“åˆ© | å‘æ˜ä¸“åˆ©ã€å®ç”¨æ–°å‹ä¸“åˆ©ç­‰ |
| å¥–é¡¹ | ç§‘æŠ€è¿›æ­¥å¥–ã€æ•™å­¦æˆæœå¥–ç­‰ |
| è‘—ä½œ | å­¦æœ¯ä¸“è‘—ã€è¯‘è‘—ç­‰ |
| è½¯ä»¶è‘—ä½œæƒ | è½¯ä»¶è‘—ä½œæƒç™»è®° |

### å­—æ®µé•¿åº¦è§„èŒƒ

| å­—æ®µç±»å‹ | é•¿åº¦ | è¯´æ˜ |
|---------|------|------|
| ç”¨æˆ·å | 50 | username, handler |
| å§“å | 50 | name, pi_name |
| é‚®ç®± | 100 | email |
| ç”µè¯ | 20 | phone |
| æ ‡é¢˜ï¼ˆçŸ­ï¼‰ | 200 | project_type, achievement title |
| æ ‡é¢˜ï¼ˆé•¿ï¼‰ | 300 | paper title |
| ä½œè€…åˆ—è¡¨ | 500 | authors, members |
| æè¿°æ–‡æœ¬ | TEXT | description, notes |

---

## æ•°æ®å¤‡ä»½ä¸æ¢å¤

### å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
# å®Œæ•´å¤‡ä»½
mysqldump -u root -p research_management_system > backup_$(date +%Y%m%d).sql

# ä»…å¤‡ä»½è¡¨ç»“æ„
mysqldump -u root -p --no-data research_management_system > schema.sql

# ä»…å¤‡ä»½æ•°æ®
mysqldump -u root -p --no-create-info research_management_system > data.sql
```

### æ¢å¤è„šæœ¬

```bash
# æ¢å¤å®Œæ•´æ•°æ®åº“
mysql -u root -p research_management_system < backup_20241202.sql

# æ¢å¤å•ä¸ªè¡¨
mysql -u root -p research_management_system < users_backup.sql
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å®šæœŸæ¸…ç†æ—¥å¿—**: ä¿ç•™è¿‘90å¤©çš„æ“ä½œæ—¥å¿—
2. **ç´¢å¼•ä¼˜åŒ–**: æ ¹æ®æ…¢æŸ¥è¯¢æ—¥å¿—æ·»åŠ ç´¢å¼•
3. **åˆ†åŒºè¡¨**: æ—¥å¿—è¡¨æŒ‰æœˆåˆ†åŒºå­˜å‚¨
4. **è¯»å†™åˆ†ç¦»**: ç»Ÿè®¡æŸ¥è¯¢ä½¿ç”¨åªè¯»ä»åº“
5. **ç¼“å­˜ç­–ç•¥**: å¸¸ç”¨å­—å…¸æ•°æ®ä½¿ç”¨Redisç¼“å­˜

---

**æ•°æ®åº“è®¾è®¡ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-02
