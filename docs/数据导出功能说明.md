# 数据导出功能使用说明

## 功能概述

为科研管理系统的5个核心模块添加了Excel数据导出功能：
1. 项目管理
2. 成果管理
3. 论文管理
4. 经费管理
5. 审计日志

## 安装依赖

首先需要安装 xlsx 依赖包：

```bash
cd frontend
npm install
```

## 使用方法

### 1. 项目管理导出

**位置**：项目管理页面右上角  
**按钮**：导出Excel  
**导出内容**：
- ID、项目名称、负责人
- 项目类型、项目来源
- 总预算、开始日期、结束日期
- 项目状态、项目目标、项目描述

**导出文件名**：`项目管理数据_YYYY-MM-DD_HH-MM-SS.xlsx`

---

### 2. 成果管理导出

**位置**：成果管理页面搜索栏  
**按钮**：导出Excel  
**导出内容**：
- ID、成果类型（专利/奖项/著作/软著）
- 成果名称、所有人、参与人员
- 完成日期、证书编号、成果描述

**导出文件名**：`成果管理数据_YYYY-MM-DD_HH-MM-SS.xlsx`

---

### 3. 论文管理导出

**位置**：论文管理页面右上角  
**按钮**：导出Excel  
**导出内容**：
- ID、论文标题、作者
- 期刊名称、发表日期、DOI
- JCR分区、中科院分区、影响因子

**导出文件名**：`论文管理数据_YYYY-MM-DD_HH-MM-SS.xlsx`

---

### 4. 经费管理导出

**位置**：经费管理页面搜索栏  
**按钮**：导出Excel  
**导出内容**：
- ID、项目名称
- 支出类型（设备费/材料费/差旅费等）
- 金额（带¥符号格式化）
- 支出日期、经办人、备注

**导出文件名**：`经费管理数据_YYYY-MM-DD_HH-MM-SS.xlsx`

---

### 5. 审计日志导出

**位置**：审计日志页面右上角  
**按钮**：导出Excel  
**导出内容**：
- ID、用户名、操作类型
- 模块、请求方法、请求路径
- 操作状态、IP地址
- 执行时间、操作时间、错误信息

**导出文件名**：`审计日志数据_YYYY-MM-DD_HH-MM-SS.xlsx`

---

## 功能特点

### ✅ 智能格式化

1. **日期格式化**
   - 自动将日期格式化为：YYYY/MM/DD
   - 示例：`2024-12-03` → `2024/12/03`

2. **日期时间格式化**
   - 完整时间格式：YYYY/MM/DD HH:MM:SS
   - 示例：`2024-12-03 10:30:45` → `2024/12/03 10:30:45`

3. **金额格式化**
   - 自动添加货币符号和千分位
   - 示例：`500000` → `¥500,000.00`

4. **枚举值转换**
   - 成果类型：`PATENT` → `专利`
   - 模块名称：`auth` → `认证`
   - 状态：`SUCCESS` → `成功`

### ✅ 自动列宽

- 根据内容类型自动设置列宽
- ID列：10个字符宽
- 日期列：15个字符宽
- 长文本列：30-40个字符宽

### ✅ 文件命名

- 自动添加时间戳
- 格式：`模块名_YYYY-MM-DD_HH-MM-SS.xlsx`
- 避免文件名冲突

### ✅ 数据验证

- 导出前检查是否有数据
- 无数据时显示友好提示
- 导出成功/失败有明确反馈

---

## 技术实现

### 核心工具函数

**文件位置**：`frontend/src/utils/export.js`

```javascript
// 主要导出函数
exportToExcel(data, columns, filename)

// 格式化辅助函数
formatDate(date)           // 日期格式化
formatDateTime(datetime)   // 日期时间格式化
formatAmount(amount)       // 金额格式化
```

### 列配置示例

```javascript
const columns = [
  { label: 'ID', prop: 'id', width: 10 },
  { 
    label: '日期', 
    prop: 'date', 
    width: 15,
    formatter: (value) => formatDate(value)
  },
  { label: '名称', prop: 'name', width: 30 }
]
```

---

## 常见问题

### Q1: 导出的Excel文件在哪里？

A: 文件会下载到浏览器默认下载目录，通常是：
- Windows：`C:\Users\用户名\Downloads`
- Mac：`/Users/用户名/Downloads`

### Q2: 导出按钮点击后无反应？

A: 请检查：
1. 当前页面是否有数据（无数据会提示）
2. 浏览器控制台是否有错误信息
3. 是否安装了 xlsx 依赖包

### Q3: 导出的数据不完整？

A: 导出的是**当前页面显示的数据**，如果需要导出所有数据：
1. 可以增加每页显示数量（如100条）
2. 或者分页多次导出

### Q4: 如何自定义导出格式？

A: 可以修改对应页面的列配置，调整：
- 列的顺序
- 列的宽度
- 格式化函数

---

## 示例效果

### 导出前
```
表格显示：
ID | 项目名称 | 预算 | 日期
1  | AI研究  | 500000 | 2024-12-03
```

### 导出后（Excel）
```
ID | 项目名称 | 预算           | 日期
1  | AI研究  | ¥500,000.00  | 2024/12/03
```

---

## 更新日志

### v1.0.0 (2024-12-03)

- ✅ 新增项目管理数据导出
- ✅ 新增成果管理数据导出
- ✅ 新增论文管理数据导出
- ✅ 新增经费管理数据导出
- ✅ 新增审计日志数据导出
- ✅ 支持智能格式化
- ✅ 支持自定义列配置

---

## 技术支持

如有问题请查看：
- 浏览器控制台错误信息
- 后端日志
- 或联系技术支持
