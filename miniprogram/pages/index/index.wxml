<!--pages/index/index.wxml-->
<wxs module="moneyUtil">
  var formatMoney = function(amount) {
    if (!amount && amount !== 0) return '0.00'
    return Number(amount).toFixed(2)
  }
  module.exports = {
    formatMoney: formatMoney
  }
</wxs>

<view class="container">
  <!-- æ¬¢è¿å¡ç‰‡ -->
  <view class="welcome-card">
    <view class="welcome-title">æ¬¢è¿ï¼Œ{{userInfo.real_name || 'ç”¨æˆ·'}}</view>
    <view class="welcome-subtitle">ç§‘ç ”ç®¡ç†ç³»ç»Ÿ - é¢†å¯¼ç«¯</view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="stats-grid">
    <view class="stat-card card" bindtap="goToProjects">
      <view class="stat-value">{{overview.project_count}}</view>
      <view class="stat-label">åœ¨ç ”é¡¹ç›®</view>
    </view>
    <view class="stat-card card" bindtap="goToPapers">
      <view class="stat-value">{{overview.paper_count}}</view>
      <view class="stat-label">å‘è¡¨è®ºæ–‡</view>
    </view>
    <view class="stat-card card" bindtap="goToAchievements">
      <view class="stat-value">{{overview.achievement_count}}</view>
      <view class="stat-label">ç§‘ç ”æˆæœ</view>
    </view>
    <view class="stat-card card" bindtap="goToFunds">
      <view class="stat-value">Â¥{{moneyUtil.formatMoney(overview.total_expense)}}</view>
      <view class="stat-label">ç»è´¹æ”¯å‡º</view>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-actions card">
    <view class="card-title">å¿«æ·å…¥å£</view>
    <view class="action-grid">
      <view class="action-item" bindtap="goToProjects">
        <view class="action-icon">ğŸ“‹</view>
        <view class="action-text">é¡¹ç›®ç®¡ç†</view>
      </view>
      <view class="action-item" bindtap="goToPapers">
        <view class="action-icon">ğŸ“„</view>
        <view class="action-text">è®ºæ–‡ç®¡ç†</view>
      </view>
      <view class="action-item" bindtap="goToFunds">
        <view class="action-icon">ğŸ’°</view>
        <view class="action-text">ç»è´¹ç®¡ç†</view>
      </view>
      <view class="action-item" bindtap="goToAchievements">
        <view class="action-icon">ğŸ†</view>
        <view class="action-text">æˆæœç®¡ç†</view>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°é¡¹ç›® -->
  <view class="recent-projects card" wx:if="{{projects.length > 0}}">
    <view class="card-title">æœ€æ–°é¡¹ç›®</view>
    <view 
      wx:for="{{projects}}" 
      wx:key="id"
      class="project-item"
      bindtap="goToProjectDetail"
      data-id="{{item.id}}"
    >
      <view class="list-item-title">{{item.project_name}}</view>
      <view class="list-item-desc">
        <text>è´Ÿè´£äººï¼š{{item.pi_name}}</text>
        <text class="ml-10">é¢„ç®—ï¼šÂ¥{{moneyUtil.formatMoney(item.budget_total)}}</text>
      </view>
      <view class="mt-10">
        <text class="tag tag-{{getStatusType(item.status)}}">{{item.status}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æç¤º -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
